<html>
<head>
    <script src="/jquery-3.3.1.min.js"></script>
    <script src="/md5.js"></script>
    <style>
        header {
            margin-top: 5px;
            margin-bottom: 10px;
        }

        footer {
            margin-top: 10px;
        }

        form {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <header>WRPCT - {%%systemName%%}</header>
    <div>{%%currentTime%%}</div>
    <div>
        Статус системы: <strong>{%%gamesStatus%%}</strong>
    </div>
    <div>
        Осталось: <strong>{%%gamesTimeLeft%%}</strong>
    </div>
    <div>
        <div>
            <input type="text" id="amount" value="60">
            <button type="submit" name="add" onclick="updateMinutes(true)">Добавить минуты</button>
            <button type="submit" name="distract" onclick="updateMinutes(false)">Вычесть минуты</button>
        </div>

        <div>
            <button type="submit" onclick="enableGames()">Разрешить игры</button>
            <button type="submit" onclick="disableGames()">Запретить игры</button>
        </div>
    </div>
    <footer><a href="{%%projectUrl%%}">Страница проекта</a></footer>

    <script type="text/javascript">
        function showError() {
            alert('Произошла ошибка при отправке запроса.');
        }

        function updateMinutes(positive) {
            var amount = positive ? $('#amount').val() : -$('#amount').val();
            $.post('update', { amount }, function (data) {
                location.reload();
            }).fail(function () {
                showError();
                location.reload();
            });
        }

        function enableGames() {
            $.post('allowgames', {}, function (data) {
                location.reload();
            }).fail(function () {
                showError();
                location.reload();
            });
        }

        function disableGames() {
            $.post('disallowgames', {}, function (data) {
                location.reload();
            }).fail(function () {
                showError();
                location.reload();
            });
        }
    </script>
</body>
</html>